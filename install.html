

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Installation &mdash; Charliecloud 0.10 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. Testing" href="test.html" />
    <link rel="prev" title="Overview" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Charliecloud
          

          
            
            <img src="_static/logo-sidebar.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                177a708
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">1.1. Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-architectures">1.1.1. Supported architectures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-time">1.1.2. Run time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-time">1.1.3. Build time</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buildah-privileged-or-unprivileged">1.1.3.1. Buildah (privileged or unprivileged)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ch-grow-unprivileged">1.1.3.2. <code class="code docutils literal notranslate"><span class="pre">ch-grow</span></code> (unprivileged)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-privileged">1.1.3.3. Docker (privileged)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#test-suite">1.1.4. Test suite</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#package-manager-install">1.2. Package manager install</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debian">1.2.1. Debian</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gentoo">1.2.2. Gentoo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opensuse-and-suse">1.2.3. openSUSE and SUSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rpm-based-distributions">1.2.4. RPM-based distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nixos">1.2.5. NixOS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#manual-build-and-install">1.3. Manual build and install</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#download">1.3.1. Download</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build">1.3.2. Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-optional">1.3.3. Install (optional)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#docker-tips">1.4. Docker tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#understand-the-security-implications-of-docker">1.4.1. Understand the security implications of Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#docker-equals-root">1.4.1.1. <code class="code docutils literal notranslate"><span class="pre">docker</span></code> equals root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#images-can-contain-bad-stuff">1.4.1.2. Images can contain bad stuff</a></li>
<li class="toctree-l4"><a class="reference internal" href="#containers-run-as-root">1.4.1.3. Containers run as root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-alters-your-network-configuration">1.4.1.4. Docker alters your network configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-installs-services">1.4.1.5. Docker installs services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-for-a-proxy">1.4.2. Configuring for a proxy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test.html">2. Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">3. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="command-usage.html">4. Charliecloud command reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="vm.html">5. Pre-installed virtual machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">6. Frequently asked questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">7. Contributor’s guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Charliecloud</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>1. Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<h1>1. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to build and install Charliecloud. For some
distributions, this can be done using your package manager; otherwise, both
normal users and admins can build and install it manually.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#dependencies" id="id3">Dependencies</a></p>
<ul>
<li><p><a class="reference internal" href="#supported-architectures" id="id4">Supported architectures</a></p></li>
<li><p><a class="reference internal" href="#run-time" id="id5">Run time</a></p></li>
<li><p><a class="reference internal" href="#build-time" id="id6">Build time</a></p></li>
<li><p><a class="reference internal" href="#test-suite" id="id7">Test suite</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#package-manager-install" id="id8">Package manager install</a></p>
<ul>
<li><p><a class="reference internal" href="#debian" id="id9">Debian</a></p></li>
<li><p><a class="reference internal" href="#gentoo" id="id10">Gentoo</a></p></li>
<li><p><a class="reference internal" href="#opensuse-and-suse" id="id11">openSUSE and SUSE</a></p></li>
<li><p><a class="reference internal" href="#rpm-based-distributions" id="id12">RPM-based distributions</a></p></li>
<li><p><a class="reference internal" href="#nixos" id="id13">NixOS</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#manual-build-and-install" id="id14">Manual build and install</a></p>
<ul>
<li><p><a class="reference internal" href="#download" id="id15">Download</a></p></li>
<li><p><a class="reference internal" href="#build" id="id16">Build</a></p></li>
<li><p><a class="reference internal" href="#install-optional" id="id17">Install (optional)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#docker-tips" id="id18">Docker tips</a></p>
<ul>
<li><p><a class="reference internal" href="#understand-the-security-implications-of-docker" id="id19">Understand the security implications of Docker</a></p></li>
<li><p><a class="reference internal" href="#configuring-for-a-proxy" id="id20">Configuring for a proxy</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="dependencies">
<h2><a class="toc-backref" href="#id3">1.1. Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>Charliecloud is a simple system with limited dependencies. If your system
meets these prerequisites but Charliecloud doesn’t work, please report that as
a bug.</p>
<p>Note that we do not rigorously track dependency versions. We update the
versions stated below as we encounter problems, but they are not tight bounds
and may be out of date.</p>
<div class="section" id="supported-architectures">
<h3><a class="toc-backref" href="#id4">1.1.1. Supported architectures</a><a class="headerlink" href="#supported-architectures" title="Permalink to this headline">¶</a></h3>
<p>Charliecloud should work on any architecture supported by the Linux kernel,
and we have run Charliecloud containers on x86-64, ARM, and Power. However, it
is currently tested only on x86_64 and ARM.</p>
<p>Most container build software is also fairly portable; e.g., see <a class="reference external" href="https://docs.docker.com/install/#supported-platforms">Docker’s
supported platforms</a>.</p>
</div>
<div class="section" id="run-time">
<h3><a class="toc-backref" href="#id5">1.1.2. Run time</a><a class="headerlink" href="#run-time" title="Permalink to this headline">¶</a></h3>
<p>Systems used for running images need:</p>
<ul class="simple">
<li><p>Recent Linux kernel with user namespaces enabled. We recommend version 4.4
or higher.</p></li>
<li><p>C11 compiler and standard library</p></li>
<li><p>POSIX.1-2017 shell and utilities</p></li>
</ul>
<p>The SquashFS workflow requires FUSE and <a class="reference external" href="https://github.com/vasi/squashfus">Squashfuse</a>. Note that distribution packages of
Squashfuse often provide only the “high level” executables; the “low level”
executables have better performance. These can be installed from source on any
distribution.</p>
<p>Some distributions need configuration changes to enable user namespaces. For
example:</p>
<ul class="simple">
<li><p>Debian Stretch <a class="reference external" href="https://superuser.com/a/1122977">needs sysctl</a>
<code class="code docutils literal notranslate"><span class="pre">kernel.unprivileged_userns_clone=1</span></code>.</p></li>
<li><p>RHEL/CentOS 7.4 and 7.5 need both a <a class="reference external" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/html-single/getting_started_with_containers/#user_namespaces_options">kernel command line option and a sysctl</a>.
<em>Important note:</em> Docker does not work with user namespaces, so skip step 4
of the Red Hat instructions, i.e., don’t add <code class="code docutils literal notranslate"><span class="pre">--userns-remap</span></code> to the
Docker configuration (see <a class="reference external" href="https://github.com/hpc/charliecloud/issues/97">issue #97</a>).</p></li>
</ul>
</div>
<div class="section" id="build-time">
<h3><a class="toc-backref" href="#id6">1.1.3. Build time</a><a class="headerlink" href="#build-time" title="Permalink to this headline">¶</a></h3>
<p>Systems used for building images need the run-time dependencies, plus
something to actually build the images. Sub-sections list Charliecloud
dependencies for each builder; see also the builders’ documentation.</p>
<p>All builders require internet access (e.g., for public Docker Hub) or
configuration for a local image repository (e.g., a private Docker Hub).</p>
<p>Additional dependencies for specific components:</p>
<ul class="simple">
<li><p>To create SquashFS image files: <code class="code docutils literal notranslate"><span class="pre">squashfs-tools</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">ch-build2dir</span></code>: Bash 4.1+</p></li>
</ul>
<div class="section" id="buildah-privileged-or-unprivileged">
<h4>1.1.3.1. Buildah (privileged or unprivileged)<a class="headerlink" href="#buildah-privileged-or-unprivileged" title="Permalink to this headline">¶</a></h4>
<p>Charliecloud can use the “rootless” mode of stock Buildah, which requires the
setuid (i.e., privileged) helpers <code class="code docutils literal notranslate"><span class="pre">newuidmap</span></code> and <code class="code docutils literal notranslate"><span class="pre">newgidmap</span></code>.</p>
<p>For a fully unprivileged workflow, Charliecloud can also use a patched Buildah
that does not require the setuid helpers. You need branch
<code class="code docutils literal notranslate"><span class="pre">chown-error-tolerant-patch</span></code> from <a class="reference external" href="https://github.com/hpc/buildah">our fork of Buildah</a>. (We are working with Buildah upstream to
merge our patches.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To configure Buildah in rootless mode, which is what Charliecloud uses,
make sure your config files are in <code class="code docutils literal notranslate"><span class="pre">~/.config/containers</span></code> and they
are correct. Particularly if your system also has configuration in
<code class="code docutils literal notranslate"><span class="pre">/etc/containers</span></code>, problems can be very hard to diagnose.</p>
</div>
</div>
<div class="section" id="ch-grow-unprivileged">
<h4>1.1.3.2. <code class="code docutils literal notranslate"><span class="pre">ch-grow</span></code> (unprivileged)<a class="headerlink" href="#ch-grow-unprivileged" title="Permalink to this headline">¶</a></h4>
<p>This is our internal unprivileged image builder and requires:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/containers/skopeo">skopeo</a></p></li>
<li><p><a class="reference external" href="https://github.com/openSUSE/umoci">umoci</a></p></li>
<li><p>Python module <code class="code docutils literal notranslate"><span class="pre">lark</span></code>
(<a class="reference external" href="https://pypi.org/project/lark-parser/">lark-parser</a> on PyPI)</p></li>
</ul>
</div>
<div class="section" id="docker-privileged">
<h4>1.1.3.3. Docker (privileged)<a class="headerlink" href="#docker-privileged" title="Permalink to this headline">¶</a></h4>
<p>Our wrapper scripts for Docker expect to run the <code class="code docutils literal notranslate"><span class="pre">docker</span></code> command under
<code class="code docutils literal notranslate"><span class="pre">sudo</span></code> and need Docker 17.03+ and <code class="code docutils literal notranslate"><span class="pre">mktemp(1)</span></code>. Older versions of
Docker may work but are untested. We know that 1.7.1 does not work.</p>
</div>
</div>
<div class="section" id="test-suite">
<h3><a class="toc-backref" href="#id7">1.1.4. Test suite</a><a class="headerlink" href="#test-suite" title="Permalink to this headline">¶</a></h3>
<p>To run the test suite, you also need:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/sstephenson/bats">Bats</a> 0.4.0</p></li>
<li><p>Bash 4.1+, for Bats and to make programming the tests tractable</p></li>
<li><p>Python 2.7 or 3.4+, for building some of the tests</p></li>
<li><p>Wget, to download stuff for some of the test images</p></li>
<li><p>root access via <code class="code docutils literal notranslate"><span class="pre">sudo</span></code> (optional), to test filesystem permissions enforcement</p></li>
</ul>
<p>Image building software tested, with varying levels of thoroughness:</p>
<ul class="simple">
<li><p>Shell scripts with various manual bootstrap and <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code></p></li>
<li><p>Docker</p></li>
<li><p><a class="reference external" href="https://github.com/containers/buildah">Buildah</a></p></li>
<li><p><a class="reference external" href="https://github.com/containers/skopeo">skopeo</a> and
<a class="reference external" href="https://github.com/openSUSE/umoci">umoci</a></p></li>
</ul>
<p>Bats can be installed at the system level or embedded in the Charliecloud
source code. If it’s in both places, the latter is used.</p>
<p>To embed Bats, either:</p>
<ul class="simple">
<li><p>Download Charliecloud using <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">--recursive</span></code>, which will check
out Bats as a submodule in <code class="code docutils literal notranslate"><span class="pre">test/bats</span></code>.</p></li>
<li><p>Unpack the Bats zip file or tarball in <code class="code docutils literal notranslate"><span class="pre">test/bats</span></code>.</p></li>
</ul>
<p>To check an embedded Bats:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> test/bats/bin/bats --version
<span class="go">Bats 0.4.0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="package-manager-install">
<h2><a class="toc-backref" href="#id8">1.2. Package manager install</a><a class="headerlink" href="#package-manager-install" title="Permalink to this headline">¶</a></h2>
<p>Charliecloud is available in some distribution package repositories, and
packages can be built for additional distributions. (Note, however, that
system-wide installation is not required — Charliecloud works fine when built
by any user and run from one’s home directory or similar.)</p>
<p>This section describes how to obtain packages for the distributions we know
about, and where to go for support on them.</p>
<p>If you’d like to build one of the packages, or if you’re a package maintainer,
see <code class="code docutils literal notranslate"><span class="pre">packaging/README</span></code> and <code class="code docutils literal notranslate"><span class="pre">packaging/*/README</span></code> for additional
documentation.</p>
<p>Pull requests and other collaboration to improve the packaging situation are
particularly welcome!</p>
<div class="section" id="debian">
<h3><a class="toc-backref" href="#id9">1.2.1. Debian</a><a class="headerlink" href="#debian" title="Permalink to this headline">¶</a></h3>
<p>Charliecloud has been proposed for inclusion in Debian; see <a class="reference external" href="https://github.com/hpc/charliecloud/issues/95">issue 95</a>.</p>
<table class="colwidths-auto docutils align-center">
<tbody>
<tr class="row-odd"><td><p>Distribution versions</p></td>
<td><p>proposed for <em>Buster</em> and <em>Stretch backports</em></p></td>
</tr>
<tr class="row-even"><td><p>Maintainers</p></td>
<td><p>Lucas Nussbaum (<code class="code docutils literal notranslate"><span class="pre">lucas&#64;debian.org</span></code>)
and Peter Wienemann (<code class="code docutils literal notranslate"><span class="pre">wienemann&#64;physik.uni-bonn.de</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p>Bug reports to</p></td>
<td><p>Charliecloud’s GitHub issue tracker</p></td>
</tr>
<tr class="row-even"><td><p>Packaging source code</p></td>
<td><p>in Charliecloud: <code class="code docutils literal notranslate"><span class="pre">packaging/debian</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="gentoo">
<h3><a class="toc-backref" href="#id10">1.2.2. Gentoo</a><a class="headerlink" href="#gentoo" title="Permalink to this headline">¶</a></h3>
<p>A native package for Gentoo is available.</p>
<table class="colwidths-auto docutils align-center">
<tbody>
<tr class="row-odd"><td><p>Package name</p></td>
<td><p><a class="reference external" href="https://packages.gentoo.org/packages/sys-cluster/charliecloud">sys-cluster/charliecloud</a></p></td>
</tr>
<tr class="row-even"><td><p>Maintainer</p></td>
<td><p>Oliver Freyermuth (<code class="code docutils literal notranslate"><span class="pre">o.freyermuth&#64;googlemail.com</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p>Bug reports to</p></td>
<td><p><a class="reference external" href="https://bugs.gentoo.org/buglist.cgi?quicksearch=sys-cluster%2Fcharliecloud">Gentoo Bugzilla</a></p></td>
</tr>
<tr class="row-even"><td><p>Packaging source code</p></td>
<td><p><a class="reference external" href="https://gitweb.gentoo.org/repo/gentoo.git/tree/sys-cluster/charliecloud">Gentoo ebuild repository</a></p></td>
</tr>
</tbody>
</table>
<p>To install:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> emerge sys-cluster/charliecloud
</pre></div>
</div>
<p>If may necessary to accept keywords first, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;=sys-cluster/charliecloud-0.2.3_pre20171121 ~amd64&quot;</span> &gt;&gt; /etc/portage/package.accept_keywords
</pre></div>
</div>
<p>A live ebuild is also available and can be keyworded via:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;~sys-cluster/charliecloud-9999 \*\*&quot;</span> &gt;&gt; /etc/portage/package.accept_keywords
</pre></div>
</div>
</div>
<div class="section" id="opensuse-and-suse">
<h3><a class="toc-backref" href="#id11">1.2.3. openSUSE and SUSE</a><a class="headerlink" href="#opensuse-and-suse" title="Permalink to this headline">¶</a></h3>
<p>Charliecloud is included in openSUSE Tumbleweed.
For SUSE Linux Enterprise users, it’s available via
<a class="reference external" href="https://packagehub.suse.com/packages/charliecloud/">SUSE Package Hub</a>.</p>
<table class="colwidths-auto docutils align-center">
<tbody>
<tr class="row-odd"><td><p>Package name</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">charliecloud</span></code>, <code class="code docutils literal notranslate"><span class="pre">charliecloud-doc</span></code> and <code class="code docutils literal notranslate"><span class="pre">charliecloud-examples</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Maintainers</p></td>
<td><p>Ana Guerrero Lopez (<code class="code docutils literal notranslate"><span class="pre">aguerrero&#64;suse.com</span></code>)
and Christian Goll (<code class="code docutils literal notranslate"><span class="pre">cgoll&#64;suse.com</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p>Bug reports to</p></td>
<td><p><a class="reference external" href="https://en.opensuse.org/openSUSE:Submitting_bug_reports">openSUSE Bugzilla</a></p></td>
</tr>
<tr class="row-even"><td><p>Packaging source code</p></td>
<td><p><a class="reference external" href="https://build.opensuse.org/package/show/network:cluster/charliecloud">openSUSE Build Service</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rpm-based-distributions">
<h3><a class="toc-backref" href="#id12">1.2.4. RPM-based distributions</a><a class="headerlink" href="#rpm-based-distributions" title="Permalink to this headline">¶</a></h3>
<p>An RPM <code class="code docutils literal notranslate"><span class="pre">.spec</span></code> file is provided in the Charliecloud source code. We are
actively seeking distribution packagers to adapt this into official packages!</p>
<table class="colwidths-auto docutils align-center">
<tbody>
<tr class="row-odd"><td><p>Repositories</p></td>
<td><p>none yet</p></td>
</tr>
<tr class="row-even"><td><p>Maintainer</p></td>
<td><p>Oliver Freyermuth (<code class="code docutils literal notranslate"><span class="pre">o.freyermuth&#64;googlemail.com</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p>Bug reports to</p></td>
<td><p>Charliecloud’s GitHub issue tracker</p></td>
</tr>
<tr class="row-even"><td><p>Packaging source code</p></td>
<td><p>in Charliecloud: <code class="code docutils literal notranslate"><span class="pre">packaging/redhat</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="nixos">
<h3><a class="toc-backref" href="#id13">1.2.5. NixOS</a><a class="headerlink" href="#nixos" title="Permalink to this headline">¶</a></h3>
<p>Charliecloud is available as a Nix package; see <a class="reference external" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/virtualization/charliecloud">See Nixpkgs repository</a>.</p>
<table class="colwidths-auto docutils align-center">
<tbody>
<tr class="row-odd"><td><p>Distribution versions</p></td>
<td><p><em>Unstable</em> channel</p></td>
</tr>
<tr class="row-even"><td><p>Maintainers</p></td>
<td><p>Bruno Bzeznik (<code class="code docutils literal notranslate"><span class="pre">Bruno&#64;bzizou.net</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p>Bug reports to</p></td>
<td><p>Nixos’s GitHub issue tracker</p></td>
</tr>
<tr class="row-even"><td><p>Packaging source code</p></td>
<td><p>Nixpkgs repository &lt;<a class="reference external" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/virtualization/charliecloud/default.nix">https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/virtualization/charliecloud/default.nix</a>&gt;`_.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="manual-build-and-install">
<h2><a class="toc-backref" href="#id14">1.3. Manual build and install</a><a class="headerlink" href="#manual-build-and-install" title="Permalink to this headline">¶</a></h2>
<div class="section" id="download">
<h3><a class="toc-backref" href="#id15">1.3.1. Download</a><a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h3>
<p>See our GitHub project: <a class="reference external" href="https://github.com/hpc/charliecloud">https://github.com/hpc/charliecloud</a></p>
<p>The recommended download method is <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">--recursive</span></code>.</p>
</div>
<div class="section" id="build">
<h3><a class="toc-backref" href="#id16">1.3.2. Build</a><a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h3>
<p>To build, simply:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> make
</pre></div>
</div>
<p>To build the documentation, see <a class="reference internal" href="dev.html#doc-build"><span class="std std-ref">the contributor’s guide</span></a>.</p>
</div>
<div class="section" id="install-optional">
<h3><a class="toc-backref" href="#id17">1.3.3. Install (optional)</a><a class="headerlink" href="#install-optional" title="Permalink to this headline">¶</a></h3>
<p>You can run Charliecloud from the source directory, and it’s recommended you
at least run the test suite before installation to establish that your system
will work.</p>
<p>To install (FHS-compliant):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> make install <span class="nv">PREFIX</span><span class="o">=</span>/foo/bar
</pre></div>
</div>
<p>Note that <code class="code docutils literal notranslate"><span class="pre">PREFIX</span></code> is required. It does not default to
<code class="code docutils literal notranslate"><span class="pre">/usr/local</span></code> like many packages.</p>
</div>
</div>
<div class="section" id="docker-tips">
<h2><a class="toc-backref" href="#id18">1.4. Docker tips</a><a class="headerlink" href="#docker-tips" title="Permalink to this headline">¶</a></h2>
<p>Docker is a convenient way to build Charliecloud images. While installing
Docker is beyond the scope of this documentation, here are a few tips.</p>
<div class="section" id="understand-the-security-implications-of-docker">
<h3><a class="toc-backref" href="#id19">1.4.1. Understand the security implications of Docker</a><a class="headerlink" href="#understand-the-security-implications-of-docker" title="Permalink to this headline">¶</a></h3>
<p>Because Docker (a) makes installing random crap from the internet really easy
and (b) is easy to deploy insecurely, you should take care. Some of the
implications are below. This list should not be considered comprehensive nor a
substitute for appropriate expertise; adhere to your moral and institutional
responsibilities.</p>
<div class="section" id="docker-equals-root">
<h4>1.4.1.1. <code class="code docutils literal notranslate"><span class="pre">docker</span></code> equals root<a class="headerlink" href="#docker-equals-root" title="Permalink to this headline">¶</a></h4>
<p>Anyone who can run the <code class="code docutils literal notranslate"><span class="pre">docker</span></code> command or interact with the Docker
daemon can <a class="reference external" href="http://web.archive.org/web/20170614013206/http://www.reventlov.com/advisories/using-the-docker-command-to-root-the-host">trivially escalate to root</a>.
This is considered a feature.</p>
<p>For this reason, don’t create the <code class="code docutils literal notranslate"><span class="pre">docker</span></code> group, as this will allow
passwordless, unlogged escalation for anyone in the group.</p>
</div>
<div class="section" id="images-can-contain-bad-stuff">
<h4>1.4.1.2. Images can contain bad stuff<a class="headerlink" href="#images-can-contain-bad-stuff" title="Permalink to this headline">¶</a></h4>
<p>Standard hygiene for “installing stuff from the internet” applies. Only work
with images you trust. The official Docker Hub repositories can help.</p>
</div>
<div class="section" id="containers-run-as-root">
<h4>1.4.1.3. Containers run as root<a class="headerlink" href="#containers-run-as-root" title="Permalink to this headline">¶</a></h4>
<p>By default, Docker runs container processes as root. In addition to being poor
hygiene, this can be an escalation path, e.g. if you bind-mount host
directories.</p>
</div>
<div class="section" id="docker-alters-your-network-configuration">
<h4>1.4.1.4. Docker alters your network configuration<a class="headerlink" href="#docker-alters-your-network-configuration" title="Permalink to this headline">¶</a></h4>
<p>To see what it did:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ifconfig    <span class="c1"># note docker0 interface</span>
<span class="gp">$</span> brctl show  <span class="c1"># note docker0 bridge</span>
<span class="gp">$</span> route -n
</pre></div>
</div>
</div>
<div class="section" id="docker-installs-services">
<h4>1.4.1.5. Docker installs services<a class="headerlink" href="#docker-installs-services" title="Permalink to this headline">¶</a></h4>
<p>If you don’t want the service starting automatically at boot, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl is-enabled docker
<span class="go">enabled</span>
<span class="gp">$</span> systemctl disable docker
<span class="gp">$</span> systemctl is-enabled docker
<span class="go">disabled</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuring-for-a-proxy">
<h3><a class="toc-backref" href="#id20">1.4.2. Configuring for a proxy</a><a class="headerlink" href="#configuring-for-a-proxy" title="Permalink to this headline">¶</a></h3>
<p>By default, Docker does not work if you have a proxy, and it fails in two
different ways.</p>
<p>The first problem is that Docker itself must be told to use a proxy. This
manifests as:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo docker run hello-world
<span class="go">Unable to find image &#39;hello-world:latest&#39; locally</span>
<span class="go">Pulling repository hello-world</span>
<span class="go">Get https://index.docker.io/v1/repositories/library/hello-world/images: dial tcp 54.152.161.54:443: connection refused</span>
</pre></div>
</div>
<p>If you have a systemd system, the <a class="reference external" href="https://docs.docker.com/engine/admin/systemd/#http-proxy">Docker documentation</a> explains how to
configure this. If you don’t have a systemd system, then
<code class="code docutils literal notranslate"><span class="pre">/etc/default/docker</span></code> might be the place to go?</p>
<p>The second problem is that Docker containers need to know about the proxy as
well. This manifests as images failing to build because they can’t download
stuff from the internet.</p>
<p>The fix is to set the proxy variables in your environment, e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export HTTP_PROXY=http://proxy.example.com:8088</span>
<span class="go">export http_proxy=$HTTP_PROXY</span>
<span class="go">export HTTPS_PROXY=$HTTP_PROXY</span>
<span class="go">export https_proxy=$HTTP_PROXY</span>
<span class="go">export ALL_PROXY=$HTTP_PROXY</span>
<span class="go">export all_proxy=$HTTP_PROXY</span>
<span class="go">export NO_PROXY=&#39;localhost,127.0.0.1,.example.com&#39;</span>
<span class="go">export no_proxy=$NO_PROXY</span>
</pre></div>
</div>
<p>You also need to teach <code class="code docutils literal notranslate"><span class="pre">sudo</span></code> to retain them. Add the following to
<code class="code docutils literal notranslate"><span class="pre">/etc/sudoers</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Defaults env_keep+=&quot;HTTP_PROXY http_proxy HTTPS_PROXY https_proxy ALL_PROXY all_proxy NO_PROXY no_proxy&quot;</span>
</pre></div>
</div>
<p>Because different programs use different subsets of these variables, and to
avoid a situation where some things work and others don’t, the Charliecloud
test suite (see below) includes a test that fails if some but not all of the
above variables are set.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="test.html" class="btn btn-neutral float-right" title="2. Testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014–2018, Los Alamos National Security, LLC

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>