

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Installation &mdash; Charliecloud 0.2.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="copyright" title="Copyright" href="copyright.html"/>
    <link rel="top" title="Charliecloud 0.2.0 documentation" href="index.html"/>
        <link rel="next" title="2. Tutorial" href="tutorial.html"/>
        <link rel="prev" title="Overview" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Charliecloud
          

          
          </a>

          
            
            
              <div class="version">
                a670e71
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prequisites">1.1. Prequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-time">1.1.1. Run time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-time">1.1.2. Build time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#download-charliecloud">1.2. Download Charliecloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="#verifying-the-system-calls">1.3. Verifying the system calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-docker">1.4. Installing Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#understand-the-security-implications-of-docker">1.4.1. Understand the security implications of Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#don-t-pipe-web-pages-to-your-shell">1.4.1.1. Don&#8217;t pipe web pages to your shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-equals-root">1.4.1.2. <code class="code docutils literal"><span class="pre">docker</span></code> equals root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#images-can-contain-bad-stuff">1.4.1.3. Images can contain bad stuff</a></li>
<li class="toctree-l4"><a class="reference internal" href="#containers-run-as-root">1.4.1.4. Containers run as root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-alters-your-network-configuration">1.4.1.5. Docker alters your network configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-installs-services">1.4.1.6. Docker installs services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-docker-for-a-proxy">1.4.2. Configuring Docker for a proxy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installing-charliecloud">1.5. Installing Charliecloud</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">2. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">3. Testing Charliecloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="script-help.html">4. Help text for executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">5. Frequently asked questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="copyright.html">6. Copyright and license</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">7. Version history</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Charliecloud</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>1. Installation</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<h1>1. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#prequisites" id="id1">Prequisites</a><ul>
<li><a class="reference internal" href="#run-time" id="id2">Run time</a></li>
<li><a class="reference internal" href="#build-time" id="id3">Build time</a></li>
</ul>
</li>
<li><a class="reference internal" href="#download-charliecloud" id="id4">Download Charliecloud</a></li>
<li><a class="reference internal" href="#verifying-the-system-calls" id="id5">Verifying the system calls</a></li>
<li><a class="reference internal" href="#installing-docker" id="id6">Installing Docker</a><ul>
<li><a class="reference internal" href="#understand-the-security-implications-of-docker" id="id7">Understand the security implications of Docker</a></li>
<li><a class="reference internal" href="#configuring-docker-for-a-proxy" id="id8">Configuring Docker for a proxy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing-charliecloud" id="id9">Installing Charliecloud</a></li>
</ul>
</div>
<div class="section" id="prequisites">
<h2><a class="toc-backref" href="#id1">1.1. Prequisites</a><a class="headerlink" href="#prequisites" title="Permalink to this headline">¶</a></h2>
<p>Charliecloud is a simple system with limited prerequisites. If your system
meets these prerequisites but Charliecloud doesn&#8217;t work, please report that as
a bug.</p>
<div class="section" id="run-time">
<h3><a class="toc-backref" href="#id2">1.1.1. Run time</a><a class="headerlink" href="#run-time" title="Permalink to this headline">¶</a></h3>
<p>Systems used for running images need:</p>
<ul class="simple">
<li>Recent Linux kernel with <code class="code docutils literal"><span class="pre">CONFIG_USER_NS=y</span></code> and <code class="code docutils literal"><span class="pre">CONFIG_OVERLAY_FS=y</span></code></li>
<li>C compiler and standard library</li>
<li>POSIX shell and utilities</li>
</ul>
<p>If you are using the upstream kernel, you will need 3.18+.</p>
<p>Distribution kernels vary. For example, RHEL7 and derivatives have a patch to
disable user namespaces in concert with mount namespaces, and overlayfs is
available as a &#8220;technology preview&#8221;.</p>
<p>Tested and working by us include the Ubuntu and upstream versions of 4.4.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We are open to patches to make Charliecloud available on older kernels. The
key parts are likely a setuid binary to avoid the user namespace and some
workaround for missing overlayfs. Please contact us if you are interested.</p>
</div>
</div>
<div class="section" id="build-time">
<h3><a class="toc-backref" href="#id3">1.1.2. Build time</a><a class="headerlink" href="#build-time" title="Permalink to this headline">¶</a></h3>
<p>Systems used for building images need the run-time prerequisites, plus:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.docker.com/">Docker</a>, recent version. We do not make compatibility guarantees with any specific version, but let us know if you run into issues.</li>
<li>Bash</li>
<li>root access using <code class="code docutils literal"><span class="pre">sudo</span></code></li>
</ul>
</div>
</div>
<div class="section" id="download-charliecloud">
<h2><a class="toc-backref" href="#id4">1.2. Download Charliecloud</a><a class="headerlink" href="#download-charliecloud" title="Permalink to this headline">¶</a></h2>
<p>See our GitHub project: <a class="reference external" href="https://github.com/hpc/charliecloud">https://github.com/hpc/charliecloud</a></p>
</div>
<div class="section" id="verifying-the-system-calls">
<h2><a class="toc-backref" href="#id5">1.3. Verifying the system calls</a><a class="headerlink" href="#verifying-the-system-calls" title="Permalink to this headline">¶</a></h2>
<p>The <code class="code docutils literal"><span class="pre">examples</span></code> directory includes a C program that exercises the key
system calls Charliecloud depends on. If this works, then Charliecloud
probably will too:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> examples/syscalls
<span class="gp">$</span> make <span class="o">&amp;&amp;</span> ./pivot_root
<span class="go">ok</span>
</pre></div>
</div>
<p>If <code class="code docutils literal"><span class="pre">pivot_root</span></code> instead reports an error, check the reported line number
in <code class="code docutils literal"><span class="pre">pivot_root.c</span></code> to see what failed.</p>
</div>
<div class="section" id="installing-docker">
<h2><a class="toc-backref" href="#id6">1.4. Installing Docker</a><a class="headerlink" href="#installing-docker" title="Permalink to this headline">¶</a></h2>
<p>While installing Docker is beyond the scope of this documentation, here are a
few tips.</p>
<div class="section" id="understand-the-security-implications-of-docker">
<h3><a class="toc-backref" href="#id7">1.4.1. Understand the security implications of Docker</a><a class="headerlink" href="#understand-the-security-implications-of-docker" title="Permalink to this headline">¶</a></h3>
<p>Because Docker (a) makes installing random crap from the internet really easy
and (b) has an &#8220;interesting&#8221; security culture, you should take care. Some of
the implications are below. This list should not be considered comprehensive
nor a substitute for appropriate expertise; adhere to your moral and
institutional responsibilities.</p>
<p>(All this stuff is a key motivation for Charliecloud.)</p>
<div class="section" id="don-t-pipe-web-pages-to-your-shell">
<h4>1.4.1.1. Don&#8217;t pipe web pages to your shell<a class="headerlink" href="#don-t-pipe-web-pages-to-your-shell" title="Permalink to this headline">¶</a></h4>
<p>This is how Docker recommends you install the software. Don&#8217;t do this:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> curl -fsSL https://get.docker.com/ <span class="p">|</span> sh
</pre></div>
</div>
<p>This approach &#8212; piping a web page directly into a shell &#8212; is easy and
fashionable but stupid.</p>
<p>The problem is that you&#8217;ve invited the web page to execute arbitrary code as
you (or worse, root). Auditing the page in a browser only helps somewhat, as
the server could use your <code class="code docutils literal"><span class="pre">User-Agent</span></code> header to decide whether to show
you safe or malicious code.</p>
<p>Download the script to a file and audit it carefully before running.</p>
</div>
<div class="section" id="docker-equals-root">
<h4>1.4.1.2. <code class="code docutils literal"><span class="pre">docker</span></code> equals root<a class="headerlink" href="#docker-equals-root" title="Permalink to this headline">¶</a></h4>
<p>Anyone who can run the <code class="code docutils literal"><span class="pre">docker</span></code> command or interact with the Docker
daemon can <a class="reference external" href="http://reventlov.com/advisories/using-the-docker-command-to-root-the-host">trivially escalate to root</a>.
This is considered a feature.</p>
<p>For this reason, don&#8217;t create the <code class="code docutils literal"><span class="pre">docker</span></code> group when the installer
offers it, as this will allow passwordless, unlogged escalation for anyone in
the group.</p>
</div>
<div class="section" id="images-can-contain-bad-stuff">
<h4>1.4.1.3. Images can contain bad stuff<a class="headerlink" href="#images-can-contain-bad-stuff" title="Permalink to this headline">¶</a></h4>
<p>Standard hygiene for &#8220;installing stuff from the internet&#8221; applies. Only work
with images you trust. The official DockerHub repositories can help.</p>
</div>
<div class="section" id="containers-run-as-root">
<h4>1.4.1.4. Containers run as root<a class="headerlink" href="#containers-run-as-root" title="Permalink to this headline">¶</a></h4>
<p>By default, Docker runs container processes as root. In addition to being poor
hygiene, this can be an escalation path, e.g. if you bind-mount host
directories.</p>
</div>
<div class="section" id="docker-alters-your-network-configuration">
<h4>1.4.1.5. Docker alters your network configuration<a class="headerlink" href="#docker-alters-your-network-configuration" title="Permalink to this headline">¶</a></h4>
<p>To see what it did:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ifconfig    <span class="c1"># note docker0 interface</span>
<span class="gp">$</span> brctl show  <span class="c1"># note docker0 bridge</span>
<span class="gp">$</span> route -n
</pre></div>
</div>
</div>
<div class="section" id="docker-installs-services">
<h4>1.4.1.6. Docker installs services<a class="headerlink" href="#docker-installs-services" title="Permalink to this headline">¶</a></h4>
<p>If you don&#8217;t want the service starting automatically at boot, e.g.:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl is-enabled docker
<span class="go">enabled</span>
<span class="gp">$</span> systemctl disable docker
<span class="gp">$</span> systemctl is-enabled docker
<span class="go">disabled</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuring-docker-for-a-proxy">
<h3><a class="toc-backref" href="#id8">1.4.2. Configuring Docker for a proxy</a><a class="headerlink" href="#configuring-docker-for-a-proxy" title="Permalink to this headline">¶</a></h3>
<p>By default, Docker does not work if you have a proxy. The symptom is this:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo docker run hello-world
<span class="go">Unable to find image &#39;hello-world:latest&#39; locally</span>
<span class="go">Pulling repository hello-world</span>
<span class="go">Get https://index.docker.io/v1/repositories/library/hello-world/images: dial tcp 54.152.161.54:443: connection refused</span>
</pre></div>
</div>
<p>The solution is to configure an override file <code class="code docutils literal"><span class="pre">http-proxy.conf</span></code> as
<a class="reference external" href="https://docs.docker.com/articles/systemd/">documented</a>. If you don&#8217;t have a
systemd system, then <code class="code docutils literal"><span class="pre">/etc/default/docker</span></code> might be the place to go.</p>
</div>
</div>
<div class="section" id="installing-charliecloud">
<h2><a class="toc-backref" href="#id9">1.5. Installing Charliecloud</a><a class="headerlink" href="#installing-charliecloud" title="Permalink to this headline">¶</a></h2>
<p>All you need in order to use Charliecloud is the executables and <code class="code docutils literal"><span class="pre">.sh</span></code>
files in <code class="code docutils literal"><span class="pre">bin</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> bin
<span class="gp">$</span> make
</pre></div>
</div>
<p>You could put this directory in your <code class="code docutils literal"><span class="pre">$PATH</span></code> or link/copy the contents
to somewhere else.</p>
<p>That said, in order to understand Charliecloud, including completing the
tutorial in the next section, you will want access to the rest of the source
code as well.</p>
<p>If you wish to build the documentation, see <code class="code docutils literal"><span class="pre">doc-src/README</span></code>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial.html" class="btn btn-neutral float-right" title="2. Tutorial" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Overview" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; <a href="copyright.html">Copyright</a> 2014–2016, Los Alamos National Security, LLC.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>