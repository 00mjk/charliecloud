

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Charliecloud command reference &mdash; Charliecloud 0.9.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Charliecloud 0.9.0 documentation" href="index.html"/>
        <link rel="next" title="5. VirtualBox appliance" href="virtualbox.html"/>
        <link rel="prev" title="3. Tutorial" href="tutorial.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Charliecloud
          

          
            
            <img src="_static/logo-sidebar.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                ef881ca
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">2. Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">3. Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Charliecloud command reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ch-build">4.1. ch-build</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synopsis">4.1.1. Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">4.1.2. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#improvements-over-plain-docker-build">4.1.3. Improvements over plain <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">4.1.4. Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ch-build2dir">4.2. ch-build2dir</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">4.2.1. Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">4.2.2. Description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ch-docker2tar">4.3. ch-docker2tar</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">4.3.1. Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">4.3.2. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">4.3.3. Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ch-docker-run">4.4. ch-docker-run</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">4.4.1. Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">4.4.2. Description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ch-fromhost">4.5. ch-fromhost</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">4.5.1. Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">4.5.2. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#options">4.5.3. Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">4.5.4. Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bugs">4.5.5. Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">4.5.6. Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ch-run">4.6. ch-run</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">4.6.1. Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">4.6.2. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-files-and-directories-available-in-container-via-bind-mounts">4.6.3. Host files and directories available in container via bind mounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-processes-in-the-same-container-with-join">4.6.4. Multiple processes in the same container with <code class="code docutils literal notranslate"><span class="pre">--join</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">4.6.5. Environment variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">4.6.6. Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ch-ssh">4.7. ch-ssh</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">4.7.1. Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">4.7.2. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">4.7.3. Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ch-tar2dir">4.8. ch-tar2dir</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16">4.8.1. Synopsis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">4.8.2. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">4.8.3. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="virtualbox.html">5. VirtualBox appliance</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">6. Frequently asked questions (FAQ)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Charliecloud</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>4. Charliecloud command reference</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="charliecloud-command-reference">
<h1>4. Charliecloud command reference<a class="headerlink" href="#charliecloud-command-reference" title="Permalink to this headline">¶</a></h1>
<p>This section is a comprehensive description of the usage and arguments of the
Charliecloud commands. Its content is identical to the commands’ man pages.</p>
<div class="section" id="ch-build">
<h2>4.1. ch-build<a class="headerlink" href="#ch-build" title="Permalink to this headline">¶</a></h2>
<p>Wrapper for <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code> that works around some of its annoying
behaviors.</p>
<div class="section" id="synopsis">
<h3>4.1.1. Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-build -t TAG <span class="o">[</span>ARGS ...<span class="o">]</span> CONTEXT
</pre></div>
</div>
</div>
<div class="section" id="description">
<h3>4.1.2. Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>Build a Docker image named <code class="code docutils literal notranslate"><span class="pre">TAG</span></code> described by Dockerfile
<code class="code docutils literal notranslate"><span class="pre">./Dockerfile</span></code> or as specified. This is a wrapper for <code class="code docutils literal notranslate"><span class="pre">docker</span>
<span class="pre">build</span></code> with various enhancements.</p>
<p>Sudo privileges are required to run the <code class="code docutils literal notranslate"><span class="pre">docker</span></code> command.</p>
<p>Arguments:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">--file</span></code></dt>
<dd>Dockerfile to use (default: <code class="code docutils literal notranslate"><span class="pre">./Dockerfile</span></code>)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-t</span></code></dt>
<dd>name (tag) of Docker image to build</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--help</span></code></dt>
<dd>print help and exit</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--version</span></code></dt>
<dd>print version and exit</dd>
</dl>
</div></blockquote>
<p>Additional arguments are accepted and passed unchanged to <code class="code docutils literal notranslate"><span class="pre">docker</span>
<span class="pre">build</span></code>.</p>
</div>
<div class="section" id="improvements-over-plain-docker-build">
<h3>4.1.3. Improvements over plain <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code><a class="headerlink" href="#improvements-over-plain-docker-build" title="Permalink to this headline">¶</a></h3>
<p><code class="code docutils literal notranslate"><span class="pre">ch-build</span></code> adds the following features to <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code>:</p>
<ul class="simple">
<li>If there is a file <code class="code docutils literal notranslate"><span class="pre">Dockerfile</span></code> in the current working directory and
<code class="code docutils literal notranslate"><span class="pre">-f</span></code> is not already specified, add <code class="code docutils literal notranslate"><span class="pre">-f</span> <span class="pre">$PWD/Dockerfile</span></code>.</li>
<li>Pass the HTTP proxy environment variables through with <code class="code docutils literal notranslate"><span class="pre">--build-arg</span></code>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The suffix <code class="code docutils literal notranslate"><span class="pre">:latest</span></code> is somewhat misleading, as neither
<code class="code docutils literal notranslate"><span class="pre">ch-build</span></code> nor bare <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code> will notice if the base
<code class="code docutils literal notranslate"><span class="pre">FROM</span></code> image has been updated. Use <code class="code docutils literal notranslate"><span class="pre">--no-cache</span></code> to make sure
you have the latest base image, at the cost of rebuilding every layer.</p>
</div>
</div>
<div class="section" id="examples">
<h3>4.1.4. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Create a Docker image tagged <code class="code docutils literal notranslate"><span class="pre">foo</span></code> and specified by the file
<code class="code docutils literal notranslate"><span class="pre">Dockerfile</span></code> located in the current working directory. Use <code class="code docutils literal notranslate"><span class="pre">/bar</span></code>
as the Docker context directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-build -t foo /bar
</pre></div>
</div>
<p>Equivalent to above:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-build -t foo --file<span class="o">=</span>./Dockerfile /bar
</pre></div>
</div>
<p>Instead, use the Dockerfile <code class="code docutils literal notranslate"><span class="pre">/baz/qux.docker</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-build -t foo --file<span class="o">=</span>/baz/qux.docker /bar
</pre></div>
</div>
<p>Note that calling your Dockerfile anything other than <code class="code docutils literal notranslate"><span class="pre">Dockerfile</span></code> will
confuse people.</p>
</div>
</div>
<div class="section" id="ch-build2dir">
<h2>4.2. ch-build2dir<a class="headerlink" href="#ch-build2dir" title="Permalink to this headline">¶</a></h2>
<p>Build a Charliecloud image from Dockerfile and unpack it.</p>
<div class="section" id="id1">
<h3>4.2.1. Synopsis<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-build2dir CONTEXT DEST <span class="o">[</span>ARGS ...<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>4.2.2. Description<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Build a Docker image as specified by the file <code class="code docutils literal notranslate"><span class="pre">Dockerfile</span></code> in the
current working directory and context directory <code class="code docutils literal notranslate"><span class="pre">CONTEXT</span></code>. Unpack it in
<code class="code docutils literal notranslate"><span class="pre">DEST</span></code>.</p>
<p>Sudo privileges are required to run the <code class="code docutils literal notranslate"><span class="pre">docker</span></code> command.</p>
<p>This runs the following command sequence: <code class="code docutils literal notranslate"><span class="pre">ch-build</span></code>,
<code class="code docutils literal notranslate"><span class="pre">ch-docker2tar</span></code>, and <code class="code docutils literal notranslate"><span class="pre">ch-tar2dir</span></code> but provides less flexibility
than the individual commands.</p>
<p>Arguments:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">CONTEXT</span></code></dt>
<dd>Docker context directory</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">DEST</span></code></dt>
<dd>directory in which to place image tarball and directory</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">ARGS</span></code></dt>
<dd>additional arguments passed to <code class="code docutils literal notranslate"><span class="pre">ch-build</span></code></dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--help</span></code></dt>
<dd>print help and exit</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--version</span></code></dt>
<dd>print version and exit</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="ch-docker2tar">
<h2>4.3. ch-docker2tar<a class="headerlink" href="#ch-docker2tar" title="Permalink to this headline">¶</a></h2>
<p>Flatten a Docker image into a Charliecloud image tarball.</p>
<div class="section" id="id3">
<h3>4.3.1. Synopsis<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-docker2tar IMAGE OUTDIR
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>4.3.2. Description<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Flattens the Docker image tagged <code class="code docutils literal notranslate"><span class="pre">IMAGE</span></code> into a Charliecloud tarball in
directory <code class="code docutils literal notranslate"><span class="pre">OUTDIR</span></code>.</p>
<p>Sudo privileges are required to run <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">export</span></code>.</p>
<p>Additional arguments:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">--help</span></code></dt>
<dd>print help and exit</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--version</span></code></dt>
<dd>print version and exit</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="example">
<h3>4.3.3. Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-docker2tar hello /var/tmp
<span class="go">57M /var/tmp/hello.tar.gz</span>
<span class="gp">$</span> ls -lh /var/tmp
<span class="go">-rw-r-----  1 reidpr reidpr  57M Feb 13 16:14 hello.tar.gz</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ch-docker-run">
<h2>4.4. ch-docker-run<a class="headerlink" href="#ch-docker-run" title="Permalink to this headline">¶</a></h2>
<p>Run a command in a Docker container.</p>
<div class="section" id="id5">
<h3>4.4.1. Synopsis<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-docker-run <span class="o">[</span>-i<span class="o">]</span> <span class="o">[</span>-b HOSTDIR:GUESTDIR ...<span class="o">]</span> TAG CMD <span class="o">[</span>ARGS ...<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>4.4.2. Description<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Runs the command <code class="code docutils literal notranslate"><span class="pre">CMD</span></code> in a Docker container using the image named
<code class="code docutils literal notranslate"><span class="pre">TAG</span></code>.</p>
<p>Sudo privileges are required for <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>.</p>
<p><code class="code docutils literal notranslate"><span class="pre">CMD</span></code> is run under your user ID. The users and groups inside the
container match those on the host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command is intended as a convenience for debugging images and
Charliecloud. Routine use for running applications is not recommended.
Instead, use <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code>.</p>
</div>
<p>Arguments:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">-i</span></code></dt>
<dd>run interactively with a pseudo-TTY</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-b</span></code></dt>
<dd>bind-mount <code class="code docutils literal notranslate"><span class="pre">HOSTDIR</span></code> at <code class="code docutils literal notranslate"><span class="pre">GUESTDIR</span></code> inside the container (can
be repeated)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--help</span></code></dt>
<dd>print help and exit</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--version</span></code></dt>
<dd>print version and exit</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="ch-fromhost">
<h2>4.5. ch-fromhost<a class="headerlink" href="#ch-fromhost" title="Permalink to this headline">¶</a></h2>
<p>Inject files from the host into an image directory.</p>
<div class="section" id="id7">
<h3>4.5.1. Synopsis<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-fromhost <span class="o">[</span>OPTION ...<span class="o">]</span> <span class="o">(</span>-c CMD <span class="p">|</span> -f FILE <span class="p">|</span> --nvidia ...<span class="o">)</span> IMGDIR
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>4.5.2. Description<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Inject files from the host into the Charliecloud image directory
<code class="code docutils literal notranslate"><span class="pre">IMGDIR</span></code>.</p>
<p>The purpose of this command is to provide host-specific files, such as GPU
libraries, to a container. It should be run after <code class="code docutils literal notranslate"><span class="pre">ch-tar2dir</span></code> and
before <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code>. After invocation, the image is no longer portable to
other hosts.</p>
<p>Injection is not atomic; if an error occurs partway through injection, the
image is left in an undefined state. Injection is currently implemented using
a simple file copy, but that may change in the future.</p>
<p>By default, file paths that contain the string <code class="code docutils literal notranslate"><span class="pre">/bin</span></code> are assumed to be
executables and are placed in <code class="code docutils literal notranslate"><span class="pre">/usr/bin</span></code> within the container. File
paths that contain the strings <code class="code docutils literal notranslate"><span class="pre">/lib</span></code> or <code class="code docutils literal notranslate"><span class="pre">.so</span></code> are assumed to be
shared libraries and are placed in the first-priority directory reported by
<code class="code docutils literal notranslate"><span class="pre">ldconfig</span></code>. Other files are placed in the directory specified by
<code class="code docutils literal notranslate"><span class="pre">--dest</span></code>.</p>
<p>You can see where shared libraries will go with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-run <span class="nv">$IMG</span> -- ldconfig -v <span class="m">2</span>&gt;/dev/null <span class="p">|</span> egrep <span class="s1">&#39;^/&#39;</span> <span class="p">|</span> cut -d: -f1 <span class="p">|</span> head -1
<span class="go">/usr/local/lib</span>
</pre></div>
</div>
<p>If any shared libraries are injected, run <code class="code docutils literal notranslate"><span class="pre">ldconfig</span></code> inside the
container (using <code class="code docutils literal notranslate"><span class="pre">ch-run</span> <span class="pre">-w</span></code>) after injection.</p>
</div>
<div class="section" id="options">
<h3>4.5.3. Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h3>
<p>To specify which files to inject:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">-c</span></code>, <code class="code docutils literal notranslate"><span class="pre">--cmd</span> <span class="pre">CMD</span></code></dt>
<dd>Inject files listed in the standard output of command <code class="code docutils literal notranslate"><span class="pre">CMD</span></code>.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-f</span></code>, <code class="code docutils literal notranslate"><span class="pre">--file</span> <span class="pre">FILE</span></code></dt>
<dd>Inject files listed in the file <code class="code docutils literal notranslate"><span class="pre">FILE</span></code>.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--nvidia</span></code></dt>
<dd>Use <code class="code docutils literal notranslate"><span class="pre">nvidia-container-cli</span> <span class="pre">list</span></code> (from <code class="code docutils literal notranslate"><span class="pre">libnvidia-container</span></code>)
to find executables and libraries to inject.</dd>
</dl>
</div></blockquote>
<p>These can be repeated, and at least one must be specified.</p>
<p>Additional arguments:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">-d</span></code>, <code class="code docutils literal notranslate"><span class="pre">--dest</span> <span class="pre">DST</span></code></p>
<blockquote>
<div>Place files whose destination cannot be inferred in directory
<code class="code docutils literal notranslate"><span class="pre">IMGDIR/DST</span></code>. If such a file is found and this option is not
specified, exit with an error.</div></blockquote>
<dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">-h</span></code>, <code class="code docutils literal notranslate"><span class="pre">--help</span></code></dt>
<dd>Print help and exit.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--no-infer</span></code></dt>
<dd>Do not infer the type of any files.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-v</span></code>, <code class="code docutils literal notranslate"><span class="pre">--verbose</span></code></dt>
<dd>Pist the injected files.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--version</span></code></dt>
<dd>Print version and exit.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="notes">
<h3>4.5.4. Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<p>Symbolic links are dereferenced, i.e., the files pointed to are injected, not
the links themselves.</p>
<p>As a corollary, do not include symlinks to shared libraries. These will be
re-created by <code class="code docutils literal notranslate"><span class="pre">ldconfig</span></code>.</p>
<p>There are two alternate approaches for nVidia GPU libraries:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Link <code class="code docutils literal notranslate"><span class="pre">libnvidia-containers</span></code> into <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> and call the
library functions directly. However, this would mean that Charliecloud
would either (a) need to be compiled differently on machines with and
without nVidia GPUs or (b) have <code class="code docutils literal notranslate"><span class="pre">libnvidia-containers</span></code> available
even on machines without nVidia GPUs. Neither of these is consistent with
Charliecloud’s philosophies of simplicity and minimal dependencies.</li>
<li>Use <code class="code docutils literal notranslate"><span class="pre">nvidia-container-cli</span> <span class="pre">configure</span></code> to do the injecting. This
would require that containers have a half-started state, where the
namespaces are active and everything is mounted but <code class="code docutils literal notranslate"><span class="pre">pivot_root(2)</span></code>
has not been performed. This is not feasible because Charliecloud has no
notion of a half-started container.</li>
</ol>
</div></blockquote>
<p>Further, while these alternate approaches would simplify or eliminate this
script for nVidia GPUs, they would not solve the problem for other situations.</p>
</div>
<div class="section" id="bugs">
<h3>4.5.5. Bugs<a class="headerlink" href="#bugs" title="Permalink to this headline">¶</a></h3>
<p>File paths may not contain newlines.</p>
</div>
<div class="section" id="id9">
<h3>4.5.6. Examples<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Place shared library <code class="code docutils literal notranslate"><span class="pre">/usr/lib64/libfoo.so</span></code> at path
<code class="code docutils literal notranslate"><span class="pre">/usr/lib/libfoo.so</span></code> within the image <code class="code docutils literal notranslate"><span class="pre">/var/tmp/baz</span></code> and
executable <code class="code docutils literal notranslate"><span class="pre">/bin/bar</span></code> at path <code class="code docutils literal notranslate"><span class="pre">/usr/bin/bar</span></code>. Then, create
appropriate symlinks to <code class="code docutils literal notranslate"><span class="pre">libfoo</span></code> and update the <code class="code docutils literal notranslate"><span class="pre">ld.so</span></code> cache.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat qux.txt
<span class="go">/bin/bar</span>
<span class="go">/usr/lib64/libfoo.so</span>
<span class="gp">$</span> ch-fromhost --file qux.txt /var/tmp/baz
</pre></div>
</div>
<p>Same as above:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-fromhost --cmd <span class="s1">&#39;cat qux.txt&#39;</span> /var/tmp/baz
</pre></div>
</div>
<p>Same as above, and also place file <code class="code docutils literal notranslate"><span class="pre">/etc/quux</span></code> at <code class="code docutils literal notranslate"><span class="pre">/etc/quux</span></code>
within the container:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat corge.txt
<span class="go">/bin/bar</span>
<span class="go">/etc/quux</span>
<span class="go">/usr/lib64/libfoo.so</span>
<span class="gp">$</span> ch-fromhost --file corge.txt --dest /etc /var/tmp/baz
</pre></div>
</div>
<p>Inject the executables and libraries recommended by nVidia into the image, and
then run <code class="code docutils literal notranslate"><span class="pre">ldconfig</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-fromhost --nvidia /var/tmp/baz
</pre></div>
</div>
</div>
</div>
<div class="section" id="ch-run">
<span id="man-ch-run"></span><h2>4.6. ch-run<a class="headerlink" href="#ch-run" title="Permalink to this headline">¶</a></h2>
<p>Run a command in a Charliecloud container.</p>
<div class="section" id="id10">
<h3>4.6.1. Synopsis<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-run <span class="o">[</span>OPTION...<span class="o">]</span> NEWROOT CMD <span class="o">[</span>ARG...<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>4.6.2. Description<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Run command <code class="code docutils literal notranslate"><span class="pre">CMD</span></code> in a Charliecloud container using the flattened and
unpacked image directory located at <code class="code docutils literal notranslate"><span class="pre">NEWROOT</span></code>.</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">-b</span></code>, <code class="code docutils literal notranslate"><span class="pre">--bind=SRC[:DST]</span></code></dt>
<dd>mount <code class="code docutils literal notranslate"><span class="pre">SRC</span></code> at guest <code class="code docutils literal notranslate"><span class="pre">DST</span></code> (default <code class="code docutils literal notranslate"><span class="pre">/mnt/0</span></code>,
<code class="code docutils literal notranslate"><span class="pre">/mnt/1</span></code>, etc.)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-c</span></code>, <code class="code docutils literal notranslate"><span class="pre">--cd=DIR</span></code></dt>
<dd>initial working directory in container</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-g</span></code>, <code class="code docutils literal notranslate"><span class="pre">--gid=GID</span></code></dt>
<dd>run as group <code class="code docutils literal notranslate"><span class="pre">GID</span></code> within container</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-j</span></code>, <code class="code docutils literal notranslate"><span class="pre">--join</span></code></dt>
<dd>use the same container (namespaces) as peer <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> invocations</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--join-ct=N</span></code></dt>
<dd>number of <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> peers (implies <code class="code docutils literal notranslate"><span class="pre">--join</span></code>; default: see below)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--join-tag=TAG</span></code></dt>
<dd>label for <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> peer group (implies <code class="code docutils literal notranslate"><span class="pre">--join</span></code>; default: see
below)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--no-home</span></code></dt>
<dd>do not bind-mount your home directory (by default, your home directory is
mounted at <code class="code docutils literal notranslate"><span class="pre">/home/$USER</span></code> in the container)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-t</span></code>, <code class="code docutils literal notranslate"><span class="pre">--private-tmp</span></code></dt>
<dd>use container-private <code class="code docutils literal notranslate"><span class="pre">/tmp</span></code> (by default, <code class="code docutils literal notranslate"><span class="pre">/tmp</span></code> is shared with
the host)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-u</span></code>, <code class="code docutils literal notranslate"><span class="pre">--uid=UID</span></code></dt>
<dd>run as user <code class="code docutils literal notranslate"><span class="pre">UID</span></code> within container</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-v</span></code>, <code class="code docutils literal notranslate"><span class="pre">--verbose</span></code></dt>
<dd>be more verbose (debug if repeated)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-w</span></code>, <code class="code docutils literal notranslate"><span class="pre">--write</span></code></dt>
<dd>mount image read-write (by default, the image is mounted read-only)</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-?</span></code>, <code class="code docutils literal notranslate"><span class="pre">--help</span></code></dt>
<dd>print help and exit</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--usage</span></code></dt>
<dd>print a short usage message and exit</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">-V</span></code>, <code class="code docutils literal notranslate"><span class="pre">--version</span></code></dt>
<dd>print version and exit</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="host-files-and-directories-available-in-container-via-bind-mounts">
<h3>4.6.3. Host files and directories available in container via bind mounts<a class="headerlink" href="#host-files-and-directories-available-in-container-via-bind-mounts" title="Permalink to this headline">¶</a></h3>
<p>In addition to any directories specified by the user with <code class="code docutils literal notranslate"><span class="pre">--bind</span></code>,
<code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> has standard host files and directories that are bind-mounted
in as well.</p>
<p>The following host files and directories are bind-mounted at the same location
in the container. These cannot be disabled.</p>
<blockquote>
<div><ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">/dev</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">/etc/passwd</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">/etc/group</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">/etc/hosts</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">/proc</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">/sys</span></code></li>
</ul>
</div></blockquote>
<p>Three additional bind mounts can be disabled by the user:</p>
<blockquote>
<div><ul class="simple">
<li>Your home directory (i.e., <code class="code docutils literal notranslate"><span class="pre">$HOME</span></code>) is mounted at guest
<code class="code docutils literal notranslate"><span class="pre">/home/$USER</span></code> by default. This is accomplished by mounting a new
<code class="code docutils literal notranslate"><span class="pre">tmpfs</span></code> at <code class="code docutils literal notranslate"><span class="pre">/home</span></code>, which hides any image content under that
path. If <code class="code docutils literal notranslate"><span class="pre">--no-home</span></code> is specified, neither of these things happens
and the image’s <code class="code docutils literal notranslate"><span class="pre">/home</span></code> is exposed unaltered.</li>
<li><code class="code docutils literal notranslate"><span class="pre">/tmp</span></code> is shared with the host by default. If <code class="code docutils literal notranslate"><span class="pre">--private-tmp</span></code>
is specified, a new <code class="code docutils literal notranslate"><span class="pre">tmpfs</span></code> is mounted on the guest’s <code class="code docutils literal notranslate"><span class="pre">/tmp</span></code>
instead.</li>
<li>If file <code class="code docutils literal notranslate"><span class="pre">/usr/bin/ch-ssh</span></code> is present in the image, it is
over-mounted with the <code class="code docutils literal notranslate"><span class="pre">ch-ssh</span></code> binary in the same directory as
<code class="code docutils literal notranslate"><span class="pre">ch-run</span></code>.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="multiple-processes-in-the-same-container-with-join">
<h3>4.6.4. Multiple processes in the same container with <code class="code docutils literal notranslate"><span class="pre">--join</span></code><a class="headerlink" href="#multiple-processes-in-the-same-container-with-join" title="Permalink to this headline">¶</a></h3>
<p>By default, different <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> invocations use different user and mount
namespaces (i.e., different containers). While this has no impact on sharing
most resources between invocations, there are a few important exceptions.
These include:</p>
<ol class="arabic simple">
<li><code class="code docutils literal notranslate"><span class="pre">ptrace(2)</span></code>, used by debuggers and related tools. One can attach a
debugger to processes in descendant namespaces, but not sibling namespaces.
The practical effect of this is that (without <code class="code docutils literal notranslate"><span class="pre">--join</span></code>), you can’t
run a command with <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> and then attach to it with a debugger
also run with <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code>.</li>
<li><em>Cross-memory attach</em> (CMA) is used by cooperating processes to communicate
by simply reading and writing one another’s memory. This is also not
permitted between sibling namespaces. This affects various MPI
implementations that use CMA to pass messages between ranks on the same
node, because it’s faster than traditional shared memory.</li>
</ol>
<p><code class="code docutils literal notranslate"><span class="pre">--join</span></code> is designed to address this by placing related <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code>
commands (the “peer group”) in the same container. This is done by one of the
peers creating the namespaces with <code class="code docutils literal notranslate"><span class="pre">unshare(2)</span></code> and the others joining
with <code class="code docutils literal notranslate"><span class="pre">setns(2)</span></code>.</p>
<p>To do so, we need to know the number of peers and a name for the group. These
are specified by additional arguments that can (hopefully) be left at default
values in most cases:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">--join-ct</span></code> sets the number of peers. The default is the value of the
first of the following environment variables that is defined:
<code class="code docutils literal notranslate"><span class="pre">OMPI_COMM_WORLD_LOCAL_SIZE</span></code>, <code class="code docutils literal notranslate"><span class="pre">SLURM_STEP_TASKS_PER_NODE</span></code>,
<code class="code docutils literal notranslate"><span class="pre">SLURM_CPUS_ON_NODE</span></code>.</li>
<li><code class="code docutils literal notranslate"><span class="pre">--join-tag</span></code> sets the tag that names the peer group. The default is
environment variable <code class="code docutils literal notranslate"><span class="pre">SLURM_STEP_ID</span></code>, if defined; otherwise, the PID
of <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code>’s parent. Tags can be re-used for peer groups that start
at different times, i.e., once all peer <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> have replaced
themselves with the user command, the tag can be re-used.</li>
</ul>
<p>Caveats:</p>
<ul class="simple">
<li>One cannot currently add peers after the fact, for example, if one decides
to start a debugger after the fact. (This is only required for code with
bugs and is thus an unusual use case.)</li>
<li><code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> instances race. The winner of this race sets up the
namespaces, and the other peers use the winner to find the namespaces to
join. Therefore, if the user command of the winner exits, any remaining
peers will not be able to join the namespaces, even if they are still
active. There is currently no general way to specify which <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code>
should be the winner.</li>
<li>If <code class="code docutils literal notranslate"><span class="pre">--join-ct</span></code> is too high, the winning <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code>’s user command
exits before all peers join, or <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> itself crashes, IPC resources
such as semaphores and shared memory segments will be leaked. These appear
as files in <code class="code docutils literal notranslate"><span class="pre">/dev/shm/</span></code> and can be removed with <code class="code docutils literal notranslate"><span class="pre">rm(1)</span></code>.</li>
<li>Many of the arguments given to the race losers, such as the image path and
<code class="code docutils literal notranslate"><span class="pre">--bind</span></code>, will be ignored in favor of what was given to the winner.</li>
</ul>
</div>
<div class="section" id="environment-variables">
<h3>4.6.5. Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p><code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> generally tries to leave environment variables unchanged, but
in some cases, guests can be significantly broken unless environment variables
are tweaked. This section lists those changes.</p>
<ul>
<li><p class="first"><code class="code docutils literal notranslate"><span class="pre">$HOME</span></code>: If the path to your home directory is not <code class="code docutils literal notranslate"><span class="pre">/home/$USER</span></code>
on the host, then an inherited <code class="code docutils literal notranslate"><span class="pre">$HOME</span></code> will be incorrect inside the
guest. This confuses some software, such as Spack.</p>
<p>Thus, we change <code class="code docutils literal notranslate"><span class="pre">$HOME</span></code> to <code class="code docutils literal notranslate"><span class="pre">/home/$USER</span></code>, unless
<code class="code docutils literal notranslate"><span class="pre">--no-home</span></code> is specified, in which case it is left unchanged.</p>
</li>
<li><p class="first"><code class="code docutils literal notranslate"><span class="pre">$PATH</span></code>: Newer Linux distributions replace some root-level
directories, such as <code class="code docutils literal notranslate"><span class="pre">/bin</span></code>, with symlinks to their counterparts in
<code class="code docutils literal notranslate"><span class="pre">/usr</span></code>.</p>
<p>Some of these distributions (e.g., Fedora 24) have also dropped <code class="code docutils literal notranslate"><span class="pre">/bin</span></code>
from the default <code class="code docutils literal notranslate"><span class="pre">$PATH</span></code>. This is a problem when the guest OS does
<em>not</em> have a merged <code class="code docutils literal notranslate"><span class="pre">/usr</span></code> (e.g., Debian 8 “Jessie”). Thus, we add
<code class="code docutils literal notranslate"><span class="pre">/bin</span></code> to <code class="code docutils literal notranslate"><span class="pre">$PATH</span></code> if it’s not already present.</p>
<p>Further reading:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/">The case for the /usr Merge</a></li>
<li><a class="reference external" href="https://fedoraproject.org/wiki/Features/UsrMove">Fedora</a></li>
<li><a class="reference external" href="https://wiki.debian.org/UsrMerge">Debian</a></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id12">
<h3>4.6.6. Examples<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Run the command <code class="code docutils literal notranslate"><span class="pre">echo</span> <span class="pre">hello</span></code> inside a Charliecloud container using the
unpacked image at <code class="code docutils literal notranslate"><span class="pre">/data/foo</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-run /data/foo -- <span class="nb">echo</span> hello
<span class="go">hello</span>
</pre></div>
</div>
<p>Run an MPI job that can use CMA to communicate:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> srun ch-run --join /data/foo -- bar
</pre></div>
</div>
</div>
</div>
<div class="section" id="ch-ssh">
<h2>4.7. ch-ssh<a class="headerlink" href="#ch-ssh" title="Permalink to this headline">¶</a></h2>
<p>Run a remote command in a Charliecloud container.</p>
<div class="section" id="id13">
<h3>4.7.1. Synopsis<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">CH_RUN_ARGS</span><span class="o">=</span><span class="s2">&quot;NEWROOT [ARG...]&quot;</span>
<span class="gp">$</span> ch-ssh <span class="o">[</span>OPTION...<span class="o">]</span> HOST CMD <span class="o">[</span>ARG...<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h3>4.7.2. Description<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Runs command <code class="code docutils literal notranslate"><span class="pre">CMD</span></code> in a Charliecloud container on remote host
<code class="code docutils literal notranslate"><span class="pre">HOST</span></code>. Use the content of environment variable <code class="code docutils literal notranslate"><span class="pre">CH_RUN_ARGS</span></code> as
the arguments to <code class="code docutils literal notranslate"><span class="pre">ch-run</span></code> on the remote host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Words in <code class="code docutils literal notranslate"><span class="pre">CH_RUN_ARGS</span></code> are delimited by spaces only; it is not shell
syntax.</p>
</div>
</div>
<div class="section" id="id15">
<h3>4.7.3. Example<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>On host bar.example.com, run the command <code class="code docutils literal notranslate"><span class="pre">echo</span> <span class="pre">hello</span></code> inside a
Charliecloud container using the unpacked image at <code class="code docutils literal notranslate"><span class="pre">/data/foo</span></code> with
starting directory <code class="code docutils literal notranslate"><span class="pre">/baz</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> hostname
<span class="go">foo</span>
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">CH_RUN_ARGS</span><span class="o">=</span><span class="s1">&#39;--cd /baz /data/foo&#39;</span>
<span class="gp">$</span> ch-ssh bar.example.com -- hostname
<span class="go">bar</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ch-tar2dir">
<h2>4.8. ch-tar2dir<a class="headerlink" href="#ch-tar2dir" title="Permalink to this headline">¶</a></h2>
<p>Unpack an image tarball into a directory.</p>
<div class="section" id="id16">
<h3>4.8.1. Synopsis<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ch-tar2dir TARBALL DIR
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h3>4.8.2. Description<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>Extract the tarball <code class="code docutils literal notranslate"><span class="pre">TARBALL</span></code> into a subdirectory of <code class="code docutils literal notranslate"><span class="pre">DIR</span></code>.
<code class="code docutils literal notranslate"><span class="pre">TARBALL</span></code> must contain a Linux filesystem image, e.g. as created by
<code class="code docutils literal notranslate"><span class="pre">ch-docker2tar</span></code>.</p>
<p>Inside <code class="code docutils literal notranslate"><span class="pre">DIR</span></code>, a subdirectory will be created whose name corresponds to
the name of the tarball with the <code class="code docutils literal notranslate"><span class="pre">.tar.gz</span></code> suffix removed. If such a
directory exists already and appears to be a Charliecloud container image, it
is removed and replaced. If the existing directory doesn’t appear to be a
container image, the script aborts with an error.</p>
<p>Additional arguments:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">--help</span></code></dt>
<dd>print help and exit</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--verbose</span></code></dt>
<dd>be more verbose</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">--version</span></code></dt>
<dd>print version and exit</dd>
</dl>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Placing <code class="code docutils literal notranslate"><span class="pre">DIR</span></code> on a shared file system can cause significant metadata
load on the file system servers. This can result in poor performance for
you and all your colleagues who use the same file system. Please consult
your site admin for a suitable location.</p>
</div>
</div>
<div class="section" id="id18">
<h3>4.8.3. Example<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -lh /var/tmp
<span class="go">total 57M</span>
<span class="go">-rw-r-----  1 reidpr reidpr  57M Feb 13 16:14 hello.tar.gz</span>
<span class="gp">$</span> ch-tar2dir /var/tmp/hello.tar.gz /var/tmp
<span class="go">creating new image /var/tmp/hello</span>
<span class="go">/var/tmp/hello unpacked ok</span>
<span class="gp">$</span> ls -lh /var/tmp
<span class="go">total 57M</span>
<span class="go">drwxr-x--- 22 reidpr reidpr 4.0K Feb 13 16:29 hello</span>
<span class="go">-rw-r-----  1 reidpr reidpr  57M Feb 13 16:14 hello.tar.gz</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="virtualbox.html" class="btn btn-neutral float-right" title="5. VirtualBox appliance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial.html" class="btn btn-neutral" title="3. Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014–2018, Los Alamos National Security, LLC.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.9.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>