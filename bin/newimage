#!/usr/bin/env python2.7

"""
Create a new virtual machine image from installation media image. Network
installations are supported.

Usage: newimage [options] NAME

Arguments:
  NAME              Basename of image file

Options:
  -h, --help        Show this help
  --base IMAGE      Create an overlay on top of existing IMAGE (--size ignored)
  --clobber         Overwrite any existing image
  --size N          Image size [default: 16G]
  --version         Print version number and exit

Note that this command does not add any of the scaffolding needed to use the
images in Charliecloud jobs.
"""

from __future__ import print_function

import charliecloud as cc

CLUSTER_SIZE = '1M'  # reduce I/Os for performance

def main():
   if (cc.cl.base):
      cc.qemu_img_create(cc.cl.name, cc.cl.clobber, base=cc.cl.base)
   else:
      cc.qemu_img_create(cc.cl.name, cc.cl.clobber, size=cc.cl.size)
   cc.qemu_img_info(cc.cl.name)


if (__name__ == '__main__'):
   cc.clargs_parse(__doc__)
   main()
